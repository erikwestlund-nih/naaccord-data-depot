# Docker Compose Environment Variables
# Generated by Ansible - DO NOT EDIT MANUALLY

# Registry and versioning
REGISTRY={{ registry }}
VERSION={{ version }}

# Redis
REDIS_PASSWORD={{ vault_redis_password }}

# Database (MariaDB runs on bare metal)
DATABASE_HOST={{ docker_env_vars.DATABASE_HOST }}
DATABASE_PORT={{ docker_env_vars.DATABASE_PORT }}
DB_NAME={{ docker_env_vars.DB_NAME }}
DB_USER={{ docker_env_vars.DB_USER }}
DB_PASSWORD={{ vault_mariadb_app_password }}
DATABASE_PASSWORD={{ vault_mariadb_app_password }}

# Application
# Environment (staging, production, development)
NAACCORD_ENVIRONMENT={{ naaccord_environment }}

# Django ALLOWED_HOSTS: domain, localhost, WireGuard tunnel IPs, and container IPs
ALLOWED_HOSTS={{ [allowed_hosts_domain] | union(allowed_hosts_localhost) | union(allowed_hosts_wireguard_tunnel) | union(allowed_hosts_wireguard_docker) | join(',') }}

# Django CSRF Configuration - Django 4.0+ requires explicit trusted origins for cross-origin POST requests
CSRF_TRUSTED_ORIGINS=https://{{ domain }}

# NAS Storage (permanent files only)
NAS_HOST={{ nas_host }}
NAS_MOUNT_POINT={{ nas_mount_point }}
NAS_UPLOADS_PATH={{ docker_env_vars.NAS_UPLOADS_PATH }}
NAS_SUBMISSIONS_PATH={{ docker_env_vars.NAS_SUBMISSIONS_PATH }}
NAS_REPORTS_PATH={{ docker_env_vars.NAS_REPORTS_PATH }}

# SAML Authentication
# Staging uses mock-idp container with real SAML, Production uses JHU Shibboleth
# USE_MOCK_SAML: Simple mock backend (development only)
# USE_DOCKER_SAML: Real SAML with djangosaml2 (staging/production)
# DISABLE_SAML: Bypass all SAML and use ModelBackend (testing/troubleshooting)
DISABLE_SAML={{ 'True' if disable_saml | default(false) else 'False' }}
USE_MOCK_SAML={{ use_mock_saml | default('False') }}
USE_DOCKER_SAML={{ 'False' if disable_saml | default(false) else (use_docker_saml | default('True' if naaccord_environment == 'staging' else 'False')) }}
SAML_ENTITY_ID={{ saml_entity_id }}
SAML_ACS_URL={{ saml_acs_url }}
SAML_SLS_URL={{ saml_sls_url }}
SAML_IDP_METADATA_URL={{ saml_idp_metadata_url | default('') }}
SAML_IDP_METADATA_FILE={{ saml_idp_metadata_file }}

# Services server hostname (for web server WireGuard client)
SERVICES_SERVER_HOST={{ services_server_host | default('services.naaccord.lan') }}

# SSL Configuration
SSL_PROVIDER={{ ssl_provider | default('none') }}
{% if ssl_provider == 'manual' %}
SSL_CERT_PATH={{ ssl_cert_path }}
SSL_KEY_PATH={{ ssl_key_path }}
SSL_CHAIN_PATH={{ ssl_chain_path }}
{% endif %}
