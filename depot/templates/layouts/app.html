{# templates/layouts/app_new.html #}

<!DOCTYPE html>
<html lang="en" class="h-full bg-white dark:bg-gray-900">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}NA Accord{% endblock %}</title>

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}">
    <link rel="manifest" href="{% static 'site.webmanifest' %}">
    <meta name="theme-color" content="#dc2626">

    <style>[x-cloak]{display:none!important;}</style>

    {% if debug and vite_running %}
        <link rel="preload" href="{{ vite_base_url }}/resources/css/app.css" as="style">
        <link rel="stylesheet" href="{{ vite_base_url }}/resources/css/app.css">
        <script type="module" src="{{ vite_base_url }}/@vite/client"></script>
        <script type="module" src="{{ vite_base_url }}/resources/js/app.js"></script>
    {% else %}
        {% for css_file in app_css_files %}
        <link rel="stylesheet" href="{% static '' %}{{ css_file }}">
        {% endfor %}
        <script type="module" src="{% static '' %}{{ app_js }}"></script>
    {% endif %}
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>

<body class="h-full">
<!-- Mobile sidebar dialog -->
<div x-data="{ sidebarOpen: false }" x-on:keydown.escape.prevent.stop="sidebarOpen = false">
    <!-- Off-canvas menu for mobile -->
    <div x-show="sidebarOpen" class="relative z-[60] lg:hidden">
        <!-- Overlay -->
        <div x-show="sidebarOpen" 
             class="fixed inset-0 bg-gray-900/80" 
             x-on:click="sidebarOpen = false"
             x-transition:enter="transition-opacity ease-linear duration-100" 
             x-transition:enter-start="opacity-0" 
             x-transition:enter-end="opacity-100" 
             x-transition:leave="transition-opacity ease-linear duration-100" 
             x-transition:leave-start="opacity-100" 
             x-transition:leave-end="opacity-0"></div>
        
        <!-- Sidebar panel -->
        <div class="fixed inset-0 flex pointer-events-none">
            <div x-show="sidebarOpen" 
                 class="relative mr-16 flex w-full max-w-xs flex-1 pointer-events-auto" 
                 x-transition:enter="transform transition ease-in-out duration-100" 
                 x-transition:enter-start="-translate-x-full" 
                 x-transition:enter-end="translate-x-0" 
                 x-transition:leave="transform transition ease-in-out duration-100" 
                 x-transition:leave-start="translate-x-0" 
                 x-transition:leave-end="-translate-x-full">
                <!-- Mobile sidebar content -->
                <div class="flex grow flex-col overflow-y-auto bg-gray-900 px-6 pb-4 ring-1 ring-white/10">
                    <div class="flex h-16 shrink-0 items-center justify-between">
                        {% if user.is_authenticated %}
                        <a href="{% url 'dashboard' %}" class="flex items-center group">
                            <c-icon icon="ribbon" family="solid" class="h-6 w-6 text-red-600 group-hover:text-red-500 transition-colors" />
                            <span class="ml-3 text-xl font-extrabold text-white group-hover:text-gray-100 transition-colors">NA ACCORD</span>
                        </a>
                        {% else %}
                        <div class="flex items-center">
                            <c-icon icon="ribbon" family="solid" class="h-6 w-6 text-red-600" />
                            <span class="ml-3 text-xl font-extrabold text-white">NA ACCORD</span>
                        </div>
                        {% endif %}
                        <button type="button" x-on:click="sidebarOpen = false" class="-m-2.5 p-2.5">
                            <span class="sr-only">Close sidebar</span>
                            <c-icon icon="x" class="h-6 w-6 text-white" />
                        </button>
                    </div>
                    <hr class="border-t border-white/10 mb-6">
                    {% if user.is_authenticated %}
                        <nav class="flex flex-1 flex-col">
                            <ul role="list" class="flex flex-1 flex-col gap-y-7">
                                <li>
                                    <ul role="list" class="-mx-2 space-y-1">
                                        <li>
                                            <a href="{% url 'precheck_validation_page' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'precheck_validation_page' %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                                <c-icon icon="flask" class="h-6 w-6 shrink-0" />
                                                Precheck Validation
                                            </a>
                                        </li>
                                        <li>
                                            <a href="{% url 'submissions' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'submissions' and not current_submission_id %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                                <c-icon icon="folder" class="h-6 w-6 shrink-0" />
                                                File Submissions
                                            </a>
                                            {% if user_submissions %}
                                            <ul role="list" class="mt-1 mb-3 ml-4 space-y-0.5 border-l border-gray-700">
                                                {% for submission in user_submissions %}
                                                <li>
                                                    <a href="{% url 'submission_detail' submission.id %}"
                                                       class="block rounded-md ml-3 py-1.5 px-3 text-sm {% if current_submission_id == submission.id %}bg-gray-600 text-gray-100 font-semibold{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                                        {{ submission.cohort.name }} {{ submission.protocol_year.year }}
                                                    </a>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            {% endif %}
                                        </li>
                                        {% if user.can_manage_submissions %}
                                            <li>
                                                <a href="{% url 'cohorts' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'cohorts' %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                                    <c-icon icon="users" class="h-6 w-6 shrink-0" />
                                                    Cohorts
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{% url 'dashboard' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'dashboard' %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                                    <c-icon icon="chart-bar" class="h-6 w-6 shrink-0" />
                                                    Dashboard
                                                </a>
                                            </li>
                                        {% endif %}
                                        {% if user.is_staff %}
                                            <li>
                                                <a href="/admin/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold text-gray-400 hover:bg-white/5 hover:text-white">
                                                    <c-icon icon="sign-posts-wrench" class="h-6 w-6 shrink-0" />
                                                    Admin Panel
                                                </a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                </li>
                                <li class="mt-auto">
                                    <div x-data="{ open: false }" x-on:click.away="open = false" class="relative">
                                        <button x-on:click="open = !open" class="group flex w-full items-center gap-x-3 rounded-md p-3 text-sm font-semibold text-gray-400 hover:bg-white/5 hover:text-white">
                                            <div class="flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-gray-800">
                                                <span class="text-sm font-medium text-white">{{ user.first_name|first|default:user.username|first }}</span>
                                            </div>
                                            <span class="truncate">{{ user.get_full_name|default:user.username }}</span>
                                            <c-icon icon="chevron-up-down" class="ml-auto h-5 w-5 shrink-0" />
                                        </button>
                                        
                                        <div x-show="open" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95" class="absolute bottom-full left-0 z-10 mb-1 w-full origin-bottom-left rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5">
                                            <a href="{% url 'account' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                <c-icon icon="user" class="mr-3 h-5 w-5 inline" />
                                                Account
                                            </a>
                                            <form method="post" action="{% url 'auth.sign_out' %}" class="block">
                                                {% csrf_token %}
                                                <button type="submit" class="block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100">
                                                    <c-icon icon="arrow-right-on-rectangle" class="mr-3 h-5 w-5 inline" />
                                                    Sign out
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </nav>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile header bar -->
    <div class="fixed top-0 left-0 right-0 z-50 bg-gray-900 lg:hidden">
        <div class="flex items-center justify-between px-4 py-3">
            <button type="button" x-on:click="sidebarOpen = true" class="text-white hover:text-gray-300">
                <span class="sr-only">Open sidebar</span>
                <c-icon icon="bars" class="h-6 w-6" />
            </button>
            {% if user.is_authenticated %}
            <a href="{% url 'dashboard' %}" class="flex items-center">
                <c-icon icon="ribbon" family="solid" class="h-5 w-5 text-red-600" />
                <span class="ml-2.5 text-lg font-extrabold text-white">NA ACCORD</span>
            </a>
            {% else %}
            <div class="flex items-center">
                <c-icon icon="ribbon" family="solid" class="h-5 w-5 text-red-600" />
                <span class="ml-2.5 text-lg font-extrabold text-white">NA ACCORD</span>
            </div>
            {% endif %}
            <div class="w-6"></div> <!-- Spacer for centering -->
        </div>
    </div>

    <!-- Static sidebar for desktop -->
    <div class="hidden bg-gray-900 ring-1 ring-white/10 lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-72 lg:flex-col">
        <div class="flex grow flex-col overflow-y-auto bg-black/10 px-6 pb-4">
            <div class="flex h-16 shrink-0 items-center">
                {% if user.is_authenticated %}
                <a href="{% url 'dashboard' %}" class="flex items-center group">
                    <c-icon icon="ribbon" family="solid" class="h-6 w-6 text-red-600 group-hover:text-red-500 transition-colors" />
                    <span class="ml-3 text-xl font-extrabold text-white group-hover:text-gray-100 transition-colors">NA ACCORD</span>
                </a>
                {% else %}
                <div class="flex items-center">
                    <c-icon icon="ribbon" family="solid" class="h-6 w-6 text-red-600" />
                    <span class="ml-3 text-xl font-extrabold text-white">NA ACCORD</span>
                </div>
                {% endif %}
            </div>
            <hr class="border-t border-white/10 mb-6">
            {% if user.is_authenticated %}
                <nav class="flex flex-1 flex-col">
                    <ul role="list" class="flex flex-1 flex-col gap-y-7">
                        <li>
                            <ul role="list" class="-mx-2 space-y-1">
                                <li>
                                    <a href="{% url 'precheck_validation_page' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'precheck_validation_page' %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                        <c-icon icon="flask" class="h-6 w-6 shrink-0" />
                                        Precheck Validation
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url 'submissions' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'submissions' and not current_submission_id %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                        <c-icon icon="folder" class="h-6 w-6 shrink-0" />
                                        File Submissions
                                    </a>
                                    {% if user_submissions %}
                                    <ul role="list" class="mt-1 mb-3 ml-4 space-y-0.5 border-l border-gray-700">
                                        {% for submission in user_submissions %}
                                        <li>
                                            <a href="{% url 'submission_detail' submission.id %}"
                                               class="block rounded-md ml-3 py-1.5 px-3 text-sm {% if current_submission_id == submission.id %}bg-gray-600 text-gray-100 font-semibold{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                                {{ submission.cohort.name }} {{ submission.protocol_year.year }}
                                            </a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </li>
                                {% if user.can_manage_submissions %}
                                    <li>
                                        <a href="{% url 'cohorts' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'cohorts' %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                            <c-icon icon="users" class="h-6 w-6 shrink-0" />
                                            Cohorts
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{% url 'dashboard' %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold {% if url_name == 'dashboard' %}bg-white/5 text-white{% else %}text-gray-400 hover:bg-white/5 hover:text-white{% endif %}">
                                            <c-icon icon="chart-bar" class="h-6 w-6 shrink-0" />
                                            Dashboard
                                        </a>
                                    </li>
                                {% endif %}
                                {% if user.is_staff %}
                                    <li>
                                        <a href="/admin/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold text-gray-400 hover:bg-white/5 hover:text-white">
                                            <c-icon icon="sign-posts-wrench" class="h-6 w-6 shrink-0" />
                                            Admin Panel
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </li>
                        {% if user_cohorts %}
                        <li>
                            <div class="text-xs font-semibold text-gray-400">Your cohorts</div>
                            <ul role="list" class="-mx-2 mt-2 space-y-1">
                                {% for cohort in user_cohorts %}
                                    {# Hide "Scan Support" cohort for everyone except scan support user (ssuppor2) #}
                                    {% if cohort.name != "Scan Support" or user.username == "ssuppor2" %}
                                    <li>
                                        <a href="{% url 'cohort_detail' cohort.id %}" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold text-gray-400 hover:bg-white/5 hover:text-white">
                                            <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-700 bg-gray-800 text-[0.625rem] font-medium text-gray-400 group-hover:text-white">
                                                {{ cohort.initials }}
                                            </span>
                                            <span class="truncate">{{ cohort.name }}</span>
                                        </a>
                                    </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </li>
                        {% endif %}
                        <li class="mt-auto">
                            <div x-data="{ open: false }" x-on:click.away="open = false" class="relative">
                                <button x-on:click="open = !open" class="group flex w-full items-center gap-x-3 rounded-md p-3 text-sm font-semibold text-gray-400 hover:bg-white/5 hover:text-white">
                                    <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-gray-700 text-white">
                                        <span class="text-lg font-medium">{{ user.first_name|first|default:user.username|first }}</span>
                                    </div>
                                    <div class="flex-1 min-w-0 text-left">
                                        <p class="text-sm font-medium text-white truncate">{{ user.get_full_name|default:user.username }}</p>
                                        <p class="text-xs text-gray-400 truncate">{{ user.email|default:"" }}</p>
                                    </div>
                                    <c-icon icon="chevron-down" class="ml-auto h-4 w-4 shrink-0 text-gray-400" />
                                </button>
                                
                                <div x-show="open" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95" class="absolute bottom-full left-0 z-10 mb-1 w-full origin-bottom-left rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5">
                                    <a href="{% url 'account' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <c-icon icon="user" class="mr-3 h-5 w-5 inline" />
                                        Account
                                    </a>
                                    <form method="post" action="{% url 'auth.sign_out' %}" class="block">
                                        {% csrf_token %}
                                        <button type="submit" class="block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100">
                                            <c-icon icon="arrow-right-on-rectangle" class="mr-3 h-5 w-5 inline" />
                                            Sign out
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </li>
                    </ul>
                </nav>
            {% endif %}
        </div>
    </div>

    <!-- Main content area - now full width without header -->
    <div class="lg:pl-72">
        <main class="bg-gray-100 min-h-screen pt-14 lg:pt-0">
            <div class="px-4 py-2 sm:px-6 lg:px-8 xl:px-12 max-w-7xl mx-auto">
                {% block body %}{% endblock %}
            </div>
        </main>
    </div>
</div>

{% include "partials/scripts.html" %}
</body>
</html>
